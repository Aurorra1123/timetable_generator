<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKUST Course Timetable Generator</title>
    <style>
        /* --- åŸºæœ¬æ ·å¼ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* --- è¾“å…¥åŒºåŸŸ --- */
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        #course-input {
            width: 100%;
            height: 200px;
            border: 2px solid #dde2e7;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }

        #course-input:focus {
            border-color: #4a90e2;
            outline: none;
        }

        #generate-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            align-self: center;
        }

        #generate-btn:hover {
            background-color: #357abd;
        }

        /* --- è¯¾è¡¨ç½‘æ ¼ --- */
        #timetable-container {
            display: grid;
            grid-template-columns: 60px repeat(5, 1fr); /* æ—¶é—´åˆ— + 5å¤© */
            grid-template-rows: 50px; /* æ˜ŸæœŸæ ‡é¢˜è¡Œ */
            background-color: white;
            border: 1px solid #e0e0e0;
        }

        .grid-header {
            font-weight: bold;
            text-align: center;
            padding: 15px 5px;
            border-bottom: 2px solid #e0e0e0;
            border-left: 1px solid #e0e0e0;
            background-color: #f9fafb;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .time-label-col {
            position: relative;
        }

        .time-label {
            position: absolute;
            right: 8px;
            transform: translateY(-50%);
            font-size: 12px;
            color: #888;
        }

        .day-column {
            position: relative;
            border-left: 1px solid #e0e0e0;
            /* ç”¨äºç”»æ¨ªçº¿ */
            background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
            background-size: 100% 60px; /* æ¯å°æ—¶ä¸€æ¡çº¿ */
        }
        
        .grid-header:first-child, .day-column:first-child {
            border-left: none;
        }

        /* --- è¯¾ç¨‹å—æ ·å¼ --- */
        .event-item {
            position: absolute;
            left: 4px;
            right: 4px;
            border-radius: 6px;
            padding: 8px;
            box-sizing: border-box;
            overflow: hidden;
            font-size: 13px;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .event-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 20;
        }

        .event-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .event-details {
            font-size: 12px;
            line-height: 1.4;
        }

        /* --- å†²çªè¯¾ç¨‹æ ·å¼ --- */
        .conflict-item {
            border: 2px solid rgba(255, 255, 255, 0.8) !important;
        }

        .conflict-item .event-title {
            font-size: 12px; /* å†²çªæ—¶æ ‡é¢˜ç¨å° */
        }

        .conflict-item .event-details {
            font-size: 10px; /* å†²çªæ—¶è¯¦æƒ…æ›´å° */
            line-height: 1.2;
        }

        /* --- Tutorialæ ·å¼ --- */
        .tutorial-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .tutorial-steps .step {
            margin-bottom: 25px;
            padding: 20px;
            border-left: 4px solid #4a90e2;
            background-color: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }

        .tutorial-steps .step h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .tutorial-steps .step p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .tutorial-tips, .tutorial-notice {
            max-width: 100%;
        }

        .tutorial-tips h4, .tutorial-notice h4 {
            margin-top: 0;
        }

        .tutorial-tips ul, .tutorial-notice ul {
            line-height: 1.6;
        }

        /* --- Tutorialåˆ‡æ¢åŠŸèƒ½æ ·å¼ --- */
        .tutorial-content {
            transition: all 0.5s ease-in-out;
            overflow: hidden;
            margin-bottom: 0;
        }

        .tutorial-content.hidden {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
        }

        .tutorial-content.visible {
            max-height: 3000px;
            opacity: 1;
            margin-bottom: 30px;
        }

        /* ç¡®ä¿tutorial sectionæœ‰è¶³å¤Ÿçš„ç©ºé—´ */
        .tutorial-section {
            margin-bottom: 20px;
            transition: margin-bottom 0.5s ease-in-out;
        }

        .tutorial-section.expanded {
            margin-bottom: 40px;
        }

        #tutorial-toggle:hover {
            background-color: #357abd;
            transform: translateY(-1px);
        }

        #tutorial-toggle:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>HKUST Course Timetable Generator</h1>
        <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 16px;">Check the HKUST/HKUST(GZ) timetable during the add/drop period</p>
        
        <!-- Tutorial Section -->
        <div class="tutorial-section" style="margin-bottom: 30px;">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 15px; display: inline-block;">ğŸ“š How to Use Tutorial</h2>
                <button id="tutorial-toggle" style="margin-left: 15px; padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s;">
                    Show Tutorial
                </button>
            </div>
            
            <div id="tutorial-content" class="tutorial-content">
            <div class="tutorial-steps">
                <div class="step">
                    <h3 style="color: #4a90e2;">Step 1: Go to Add Classes Page</h3>
                    <p>Login to SIS and go to <strong>[Student Center -> Enroll -> Add]</strong></p>
                    <p>You may need to select the correct term and click "Continue".</p>
                    <div style="text-align: center; margin: 15px 0;">
                        <img src="img/step1.jpg" alt="Step 1 Screenshot" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>
                
                <div class="step">
                    <h3 style="color: #4a90e2;">Step 2: Select Courses and Copy</h3>
                    <p>Dragging the pointer or finger to select courses.</p>
                    <p><strong>(You do NOT need to carefully select each course)</strong></p>
                    <p>The converter will recognize which courses are included.</p>
                    <div style="text-align: center; margin: 15px 0;">
                        <img src="img/step2.jpg" alt="Step 2 Screenshot" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>
                
                <div class="step">
                    <h3 style="color: #4a90e2;">Step 3: Paste and Generate</h3>
                    <p>Copy the selected courses and paste them to the text area below.</p>
                    <p>Click the <strong>"Generate Timetable"</strong> button.</p>
                    <p>The generator will extract and display your course schedule.</p>
                </div>
                
                <div class="step">
                    <h3 style="color: #4a90e2;">Step 4: View Your Timetable</h3>
                    <p>Your courses will be displayed in a visual timetable format.</p>
                    <p>Time conflicts will be shown side by side for easy comparison.</p>
                </div>
            </div>
            
            <div class="tutorial-tips" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <h4 style="color: #2c3e50; margin-bottom: 10px;">ğŸ’¡ Tips:</h4>
                <ul style="margin: 0; padding-left: 20px;">
                    <li>You can press <strong>Ctrl + A</strong> to select all page content - extra information won't affect the result.</li>
                    <li>The generator supports courses from UCUG, UFUG, AIAA, SMMG, DSAA and other HKUST departments.</li>
                    <li>Time conflicts are automatically detected and displayed side by side.</li>
                </ul>
            </div>
            
            <div class="tutorial-notice" style="background-color: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ffc107;">
                <h4 style="color: #856404; margin-bottom: 10px;">âš ï¸ Notice:</h4>
                <ul style="margin: 0; padding-left: 20px; color: #856404;">
                    <li>The generator may not work properly if course information is not copied correctly.</li>
                    <li>Make sure to copy from the official HKUST SIS system.</li>
                    <li>If you find any bugs, please report them with screenshots and course information.</li>
                </ul>
            </div>
            </div>
        </div>
        
        <div class="input-area">
            <textarea id="course-input" placeholder="Paste your course information here..."></textarea>
            <button id="generate-btn">Generate Timetable</button>
        </div>
        <div id="timetable-container">
            </div>
    </div>

    <!-- Footer -->
    <footer style="margin-top: 40px; padding: 20px 0; border-top: 1px solid #e0e0e0; background-color: #f8f9fa;">
        <div style="max-width: 1400px; margin: 0 auto; text-align: center; color: #666; font-size: 14px;">
            <div style="margin-bottom: 10px;">
                <span style="margin: 0 15px;">ğŸ“§ Contact: <a href="mailto:aurorra1123@gmail.com" style="color: #4a90e2; text-decoration: none;">aurorra1123@gmail.com</a></span>
                <span style="margin: 0 15px;">â­ <a href="https://github.com/Aurorra1123/timetable_generator" target="_blank" style="color: #4a90e2; text-decoration: none;">GitHub</a></span>
                <span style="margin: 0 15px;">ğŸ’ <a href="#" onclick="showSponsorModal(); return false;" style="color: #4a90e2; text-decoration: none;">Buy me a coffee</a></span>
            </div>
            <div style="font-size: 12px; color: #999;">
                Made for â¤ï¸HKUST&HKUST(GZ) student
            </div>
        </div>
    </footer>

    <!-- Sponsor Modal -->
    <div id="sponsor-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);" onclick="hideSponsorModal()">
        <div style="position: relative; margin: 5% auto; max-width: 90%; max-height: 90%; text-align: center;">
            <span onclick="hideSponsorModal()" style="position: absolute; top: -40px; right: 0; color: white; font-size: 35px; font-weight: bold; cursor: pointer; z-index: 1001;">&times;</span>
            <img src="img/sponsor.jpg" alt="Sponsor QR Code" style="max-width: 100%; max-height: 80vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="color: white; margin-top: 15px; font-size: 16px;">
                Thank you for your support! ğŸ™
            </div>
        </div>
    </div>

    <script>
        // Tutorialåˆ‡æ¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const tutorialToggle = document.getElementById('tutorial-toggle');
            const tutorialContent = document.getElementById('tutorial-content');
            const tutorialSection = document.querySelector('.tutorial-section');
            let isHidden = true;

            // åˆå§‹çŠ¶æ€è®¾ä¸ºéšè—
            tutorialContent.classList.add('hidden');

            tutorialToggle.addEventListener('click', function() {
                if (isHidden) {
                    // æ˜¾ç¤ºtutorial
                    tutorialContent.classList.remove('hidden');
                    tutorialContent.classList.add('visible');
                    tutorialSection.classList.add('expanded');
                    tutorialToggle.textContent = 'Hide Tutorial';
                    tutorialToggle.style.backgroundColor = '#4a90e2';
                } else {
                    // éšè—tutorial
                    tutorialContent.classList.remove('visible');
                    tutorialContent.classList.add('hidden');
                    tutorialSection.classList.remove('expanded');
                    tutorialToggle.textContent = 'Show Tutorial';
                    tutorialToggle.style.backgroundColor = '#28a745';
                }
                isHidden = !isHidden;
            });
        });

        // Sponsoræ¨¡æ€æ¡†åŠŸèƒ½
        function showSponsorModal() {
            document.getElementById('sponsor-modal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        }

        function hideSponsorModal() {
            document.getElementById('sponsor-modal').style.display = 'none';
            document.body.style.overflow = 'auto'; // æ¢å¤æ»šåŠ¨
        }

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hideSponsorModal();
            }
        });

        document.getElementById('generate-btn').addEventListener('click', function() {
            const rawText = document.getElementById('course-input').value;
            const courses = parseCourseText(rawText);
            renderTimetable(courses);
        });

        // è§£æç²˜è´´çš„æ–‡æœ¬
        function parseCourseText(text) {
            // é¢„å¤„ç†ï¼šåˆ é™¤åŒ…å«"Open"å’Œ"Delete"çš„è¡Œ
            const cleanedText = text.split('\n')
                .filter(line => {
                    const trimmedLine = line.trim();
                    return !trimmedLine.includes('Open') && !trimmedLine.includes('Delete');
                })
                .join('\n');
            
            // ä½¿ç”¨è¯¾ç¨‹ä»£ç ä½œä¸ºåˆ†å‰²æ ‡å¿—ï¼Œè€Œä¸æ˜¯ä¾èµ–ç©ºè¡Œ
            const allCourses = [];
            const dayMap = { 'Mo': 'Mon', 'Tu': 'Tue', 'We': 'Wed', 'Th': 'Thu', 'Fr': 'Fri' };
            const validPrefixes = ['UCUG', 'UFUG', 'AIAA', 'SMMG', 'DSAA','AMAT','BSBE','CMAA','CNCG','FDLE','DDSAA','EOAS','FTEC','FUNH','INFH','INTR','IOTA','IPEN','LANG','MIC','MSS','MP','DEVP','LED','ROAS','SEEN','SOCH','SYSH','UCMP','UGOD'];
            
            // å°†æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²
            const allLines = cleanedText.split('\n').map(l => l.trim()).filter(l => l);
            
            // æ‰¾åˆ°æ‰€æœ‰è¯¾ç¨‹ä»£ç è¡Œçš„ç´¢å¼•
            const courseStartIndices = [];
            for (let i = 0; i < allLines.length; i++) {
                const line = allLines[i];
                if (validPrefixes.some(prefix => line.startsWith(prefix))) {
                    courseStartIndices.push(i);
                }
            }
            
            // æŒ‰è¯¾ç¨‹ä»£ç åˆ†å‰²æˆè¯¾ç¨‹å—
            for (let i = 0; i < courseStartIndices.length; i++) {
                const startIndex = courseStartIndices[i];
                const endIndex = i < courseStartIndices.length - 1 ? courseStartIndices[i + 1] : allLines.length;
                
                // æå–å½“å‰è¯¾ç¨‹çš„æ‰€æœ‰è¡Œ
                const courseLines = allLines.slice(startIndex, endIndex);
                if (courseLines.length < 4) continue; // è‡³å°‘éœ€è¦4è¡Œï¼šè¯¾ç¨‹åã€ç¼–å·ã€æ—¶é—´ã€åœ°ç‚¹

                const course = {};
                course.code = courseLines[0]; // ç¬¬ä¸€è¡Œå°±æ˜¯è¯¾ç¨‹ä»£ç 
                
                // æŸ¥æ‰¾æ—¶é—´è¡Œï¼ˆæ ¼å¼ï¼šMoWe 16:30 - 17:50ï¼‰
                let timeLineIndex = -1;
                for (let j = 0; j < courseLines.length; j++) {
                    if (/^(Mo|Tu|We|Th|Fr)+ \d{2}:\d{2} - \d{2}:\d{2}/.test(courseLines[j])) {
                        timeLineIndex = j;
                        break;
                    }
                }
                
                if (timeLineIndex === -1) continue; // æ²¡æ‰¾åˆ°æ—¶é—´è¡Œï¼Œè·³è¿‡è¿™ä¸ªè¯¾ç¨‹

                // è§£ææ—¶é—´è¡Œ
                const timeLine = courseLines[timeLineIndex];
                const timeMatch = timeLine.match(/^([MoTuWeThFr]+) (\d{2}:\d{2}) - (\d{2}:\d{2})/);
                if (!timeMatch) continue;
                
                const [, daysStr, startTime, endTime] = timeMatch;
                course.startTime = startTime;
                course.endTime = endTime;
                
                // åœ°ç‚¹é€šå¸¸åœ¨æ—¶é—´è¡Œçš„ä¸‹ä¸€è¡Œ
                let locationLineIndex = timeLineIndex + 1;
                if (locationLineIndex < courseLines.length && courseLines[locationLineIndex].startsWith('Rm')) {
                    course.location = courseLines[locationLineIndex];
                } else {
                    course.location = 'æœªçŸ¥åœ°ç‚¹';
                }
                
                // æ•™å¸ˆä¿¡æ¯åœ¨åœ°ç‚¹ä¹‹åï¼Œå­¦åˆ†ä¹‹å‰
                let instructorLines = [];
                for (let j = locationLineIndex + 1; j < courseLines.length; j++) {
                    const line = courseLines[j];
                    // è·³è¿‡è¯¾ç¨‹ç¼–å·ï¼ˆæ‹¬å·åŒ…å›´çš„æ•°å­—ï¼‰å’Œå­¦åˆ†ï¼ˆå¦‚3.00ï¼‰
                    if (!/^\(\d+\)$/.test(line) && !/^\d+\.\d{2}$/.test(line) && line !== '') {
                        instructorLines.push(line);
                    }
                }
                course.instructor = instructorLines.join(', ') || 'æœªçŸ¥æ•™å¸ˆ';

                // å¤„ç†å¤šå¤©è¯¾ç¨‹ (å¦‚ MoWe, TuTh)
                const days = daysStr.match(/(Mo|Tu|We|Th|Fr)/g);
                if (days) {
                    days.forEach(day => {
                        allCourses.push({
                            ...course,
                            day: dayMap[day]
                        });
                    });
                }
            }
            return allCourses;
        }
        
        // æ£€æµ‹æ—¶é—´å†²çª
        function detectTimeConflicts(courses) {
            const conflictGroups = [];
            const processed = new Set();
            
            for (let i = 0; i < courses.length; i++) {
                if (processed.has(i)) continue;
                
                const currentCourse = courses[i];
                const conflictGroup = [currentCourse];
                processed.add(i);
                
                // æ£€æŸ¥ä¸å…¶ä»–è¯¾ç¨‹çš„æ—¶é—´å†²çª
                for (let j = i + 1; j < courses.length; j++) {
                    if (processed.has(j)) continue;
                    
                    const otherCourse = courses[j];
                    if (hasTimeOverlap(currentCourse, otherCourse)) {
                        conflictGroup.push(otherCourse);
                        processed.add(j);
                    }
                }
                
                conflictGroups.push(conflictGroup);
            }
            
            return conflictGroups;
        }
        
        // æ£€æŸ¥ä¸¤ä¸ªè¯¾ç¨‹æ˜¯å¦æœ‰æ—¶é—´é‡å 
        function hasTimeOverlap(course1, course2) {
            const [start1H, start1M] = course1.startTime.split(':').map(Number);
            const [end1H, end1M] = course1.endTime.split(':').map(Number);
            const [start2H, start2M] = course2.startTime.split(':').map(Number);
            const [end2H, end2M] = course2.endTime.split(':').map(Number);
            
            const start1Minutes = start1H * 60 + start1M;
            const end1Minutes = end1H * 60 + end1M;
            const start2Minutes = start2H * 60 + start2M;
            const end2Minutes = end2H * 60 + end2M;
            
            // æ£€æŸ¥æ—¶é—´æ®µæ˜¯å¦æœ‰é‡å 
            return !(end1Minutes <= start2Minutes || end2Minutes <= start1Minutes);
        }
        
        // æ¸²æŸ“è¯¾è¡¨
        function renderTimetable(courses) {
            const container = document.getElementById('timetable-container');
            container.innerHTML = ''; // æ¸…ç©ºæ—§è¯¾è¡¨

            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            const startHour = 8;
            const endHour = 22;
            const totalHours = endHour - startHour;
            const hourHeight = 60; // æ¯å°æ—¶60åƒç´ 

            // --- 1. åˆ›å»ºç½‘æ ¼æ¡†æ¶ ---
            // æ˜ŸæœŸæ ‡é¢˜è¡Œ
            container.innerHTML += `<div class="grid-header"></div>`; // å·¦ä¸Šè§’ç©ºç™½æ ¼
            days.forEach(day => {
                let dayName = {Mon: 'Mon', Tue: 'Tue', Wed: 'Wed', Thu: 'Thu', Fri: 'Fri'}[day];
                container.innerHTML += `<div class="grid-header">${dayName}</div>`;
            });

            // æ—¶é—´åˆ—å’Œæ¯æ—¥åˆ—
            const timeCol = document.createElement('div');
            timeCol.className = 'time-label-col';
            
            const dayCols = days.map(day => {
                const col = document.createElement('div');
                col.className = 'day-column';
                col.style.height = `${totalHours * hourHeight}px`;
                return col;
            });

            // æ·»åŠ æ—¶é—´åˆ»åº¦
            for (let i = 0; i <= totalHours; i++) {
                const hour = startHour + i;
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                timeLabel.innerText = `${hour.toString().padStart(2, '0')}:00`;
                timeLabel.style.top = `${i * hourHeight}px`;
                timeCol.appendChild(timeLabel);
            }
            
            container.appendChild(timeCol);
            dayCols.forEach(col => container.appendChild(col));

            // --- 2. æ£€æµ‹æ—¶é—´å†²çªå¹¶æ”¾ç½®è¯¾ç¨‹å— ---
            const courseColors = {};
            const colors = ['#e57373', '#81c784', '#64b5f6', '#ffb74d', '#ba68c8', '#4dd0e1', '#f06292', '#7986cb'];
            let colorIndex = 0;

            // æŒ‰å¤©åˆ†ç»„è¯¾ç¨‹
            const coursesByDay = {};
            days.forEach(day => coursesByDay[day] = []);
            
            courses.forEach(course => {
                if (days.includes(course.day)) {
                    coursesByDay[course.day].push(course);
                }
            });

            // ä¸ºæ¯å¤©æ£€æµ‹å†²çªå¹¶æ¸²æŸ“è¯¾ç¨‹
            days.forEach((day, dayIndex) => {
                const dayCourses = coursesByDay[day];
                if (dayCourses.length === 0) return;

                // æ£€æµ‹æ—¶é—´å†²çª
                const conflictGroups = detectTimeConflicts(dayCourses);
                
                conflictGroups.forEach(group => {
                    const conflictCount = group.length;
                    
                    group.forEach((course, conflictIndex) => {
                        // åˆ†é…é¢œè‰²
                        const baseCode = course.code.split('-')[0];
                        if (!courseColors[baseCode]) {
                            courseColors[baseCode] = colors[colorIndex % colors.length];
                            colorIndex++;
                        }
                        const color = courseColors[baseCode];

                        // è®¡ç®—ä½ç½®
                        const [startH, startM] = course.startTime.split(':').map(Number);
                        const [endH, endM] = course.endTime.split(':').map(Number);

                        const top = ((startH - startHour) + startM / 60) * hourHeight;
                        const height = ((endH + endM / 60) - (startH + startM / 60)) * hourHeight;
                        
                        // åˆ›å»ºè¯¾ç¨‹å—å…ƒç´ 
                        const eventEl = document.createElement('div');
                        eventEl.className = 'event-item';
                        eventEl.style.top = `${top}px`;
                        eventEl.style.height = `${height - 2}px`;
                        eventEl.style.backgroundColor = color;
                        
                        // å¤„ç†å†²çªå¸ƒå±€ï¼šå¹¶æ’æ˜¾ç¤º
                        if (conflictCount > 1) {
                            const width = Math.floor(100 / conflictCount);
                            const leftOffset = width * conflictIndex;
                            eventEl.style.width = `${width - 1}%`; // å‡1%ç•™é—´è·
                            eventEl.style.left = `${leftOffset}%`;
                            eventEl.style.right = 'auto';
                            eventEl.classList.add('conflict-item');
                        }

                        eventEl.innerHTML = `
                            <div class="event-title">${course.code}</div>
                            <div class="event-details">
                                ${course.instructor}<br>
                                ${course.location}
                            </div>
                        `;
                        
                        dayCols[dayIndex].appendChild(eventEl);
                    });
                });
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶æä¾›ä¸€ä¸ªç¤ºä¾‹
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('course-input').value = `AIAA 2290-L02
(6367)
Fr 13:30 - 16:20
Rm 149, E1
HU, Xuming
3.00
Open
Delete
UCUG 1077-L04
(6473)
MoWe 09:00 - 10:20
Rm 148, E1
LUO, Moxuan
3.00
Open
Delete
UCUG 1809-L01
(6683)
Tu 12:00 - 14:50
Rm 233, W1
MA, Jinyuan;
ZHU, Junhua
3.00
Open
Delete
UFUG 2103-L06
(6575)
MoWe 10:30 - 11:50
Rm 102, W1
YU, Huan
3.00
Open
UFUG 2104-L01
(6603)
TuTh 10:30 - 11:50
Rm 222, W1
ZHANG, Xuning
3.00`;
        });

    </script>
</body>
</html>